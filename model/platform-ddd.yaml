# Commercial Banking Platform - DDD Model (Restructured)
# Phase 2 - Strategic Focus
# Version: 0.2.0

system:
  id: sys_cash_mgmt_platform
  name: Commercial Banking Cash Management Platform
  version: 0.2.0
  domains:
    - dom_service_profiles
    - dom_user_management
    - dom_approval_workflows
    - dom_external_data

# ==============================================================================
# DOMAINS
# ==============================================================================

domains:
  dom_service_profiles:
    id: dom_service_profiles
    name: Service Profiles
    type: core
    strategic_importance: critical
    description: >
      Core domain managing SERVICE PROFILES for clients (not clients themselves - client
      data from SRF/GID). Three profile types: servicing, online (direct client), indirect
      (payor). Service enrollment managed through application services (stand-alone like BTR,
      online like Receivables, indirect like receivable-approval). Indirect client management
      is part of this domain since indirect clients exist only to serve indirect service profiles.
    bounded_contexts:
      - bc_service_profile_management
      - bc_indirect_client_management

  dom_user_management:
    id: dom_user_management
    name: User Management
    type: core
    strategic_importance: critical
    description: >
      User lifecycle for direct clients (Express sync) and indirect clients (Okta managed).
      Identity provider integration with dual providers. Permission and approval policy
      management (AWS IAM-inspired). Policies define WHO can DO WHAT on WHICH resources.
    bounded_contexts:
      - bc_users
      - bc_identity_integration
      - bc_policy

  dom_approval_workflows:
    id: dom_approval_workflows
    name: Approval Workflows
    type: core
    strategic_importance: critical
    description: >
      Generic approval workflow execution engine. Executes approval workflows based on
      policies defined in User Management domain. Parallel approval only (MVP). Reusable
      across all services. Critical for business operations requiring approval controls.
    bounded_contexts:
      - bc_approval_engine

  dom_external_data:
    id: dom_external_data
    name: External Data
    type: supporting
    strategic_importance: important
    description: >
      Provides SERVING LAYER (read-only) for Service Profile domain to access external data: client
      demographics (SRF), account data (SRF), and user data (Express). Consumes gold copy data created
      by data engineering pipelines. Serving layer abstracts external systems from domain model.
    bounded_contexts:
      - bc_external_data_serving

# ==============================================================================
# BOUNDED CONTEXTS
# ==============================================================================

bounded_contexts:
  bc_service_profile_management:
    id: bc_service_profile_management
    name: Service Profile Management
    domain_ref: dom_service_profiles
    description: >
      Manages SERVICE PROFILES (not clients). Links to client data (SRF/GID/IND). Three
      types: servicing, online, indirect. Enrolls services and accounts through application
      services. Consumes account and client data from serving layers (read-only).
    responsibilities:
      - Create/manage service profiles (servicing, online, indirect)
      - Link profile to SRF/GID client data (external)
      - Enroll services to profiles through application services
      - Enroll accounts to profiles (via serving layer)
      - Link online profile to Express (site-id)
      - Store permission/approval policies (owned by profile)
    application_services:
      - svc_app_servicing_profile
      - svc_app_online_profile
      - svc_app_indirect_profile

  bc_indirect_client_management:
    id: bc_indirect_client_management
    name: Indirect Client Management
    domain_ref: dom_service_profiles
    description: >
      Manages indirect clients (BUSINESS payors only, MVP). Part of Service Profiles domain
      since indirect clients exist only for indirect service profiles. IND identification,
      business info, related persons. Self-service user/permission/approval management.
    responsibilities:
      - Create/manage indirect client profiles (IND ID)
      - Store business info and related persons
      - Link to direct client service profile
      - Support self-service management

  svc_app_servicing_profile:
    id: svc_app_servicing_profile
    name: Servicing Profile Service
    bounded_context_ref: bc_service_profile_management
    description: >
      Application service for managing servicing profiles. Creates new servicing profile linked
      to SRF/GID client. Adds, modifies, and removes services linked to this profile. Enrolls
      accounts. Manages permission/approval policies owned by servicing profile.
    responsibilities:
      - Create new servicing profile (link to SRF/GID client)
      - Add services to servicing profile
      - Modify service configurations on profile
      - Remove services from profile
      - Enroll accounts to services on profile
      - Manage permission/approval policies for profile
      - Use users and user groups as policy subjects

  svc_app_online_profile:
    id: svc_app_online_profile
    name: Online Profile Service
    bounded_context_ref: bc_service_profile_management
    description: >
      Application service for managing online profiles (direct client). Creates new online profile
      with single primary client (MVP). Links to Express via site-id. Adds, modifies, removes
      services like Receivables. Onboards indirect clients (payors). Manages bank-configured
      permission/approval policies.
    responsibilities:
      - Create new online profile (link to SRF primary client + Express site-id)
      - Add services to online profile (Receivables, etc.)
      - Modify service configurations on profile
      - Remove services from profile
      - Enroll GSAN and other accounts to services
      - Onboard indirect clients for Receivables service
      - Manage permission/approval policies (bank-configured, MVP)
      - Use users and user groups as policy subjects

  svc_app_indirect_profile:
    id: svc_app_indirect_profile
    name: Indirect Profile Service
    bounded_context_ref: bc_service_profile_management
    description: >
      Application service for managing indirect profiles (business payors). Creates new indirect
      profile linked to IND client. Adds, modifies, removes services like Receivable-Approval.
      Links Canadian bank accounts. Manages self-service permission/approval policies configured
      by payor.
    responsibilities:
      - Create new indirect profile (link to IND indirect client)
      - Add services to indirect profile (Receivable-Approval, etc.)
      - Modify service configurations on profile
      - Remove services from profile
      - Link payor Canadian bank accounts for invoice payments
      - Manage permission/approval policies (self-service configured)
      - Use users and user groups as policy subjects
      - Coordinate invoice approvals via bc_approval_engine

  bc_users:
    id: bc_users
    name: Users
    domain_ref: dom_user_management
    description: >
      Manages users and user groups. Direct client users (replicated from Express) and indirect
      client users (managed in Okta). ~1050 indirect users across 700 business payors (MVP).
      Users and user groups used as subjects in permission/approval policies.
    responsibilities:
      - Replicate direct client users from Express (read-only)
      - Manage indirect client users in Okta (full lifecycle)
      - Manage user groups for policy subjects
      - Track user roles and states
      - Enforce dual admin requirement
      - Provide users and user groups for policy evaluation

  bc_identity_integration:
    id: bc_identity_integration
    name: Identity Integration
    domain_ref: dom_user_management
    description: >
      Anti-corruption layer for dual identity providers. Consumes Express user events
      (add, update) via streaming. Integrates with Okta APIs for indirect client users.
    responsibilities:
      - Consume Express user events (anti-corruption layer)
      - Integrate with Okta APIs for indirect users
      - Abstract identity provider differences
      - Translate to platform user model

  bc_policy:
    id: bc_policy
    name: Policy
    domain_ref: dom_user_management
    description: >
      Permission and approval policy management (AWS IAM-inspired). Policies owned by service
      profiles. Subject (user/user group from bc_users), action (URN), resource (accounts/services).
      Approval policy adds approver count and thresholds. Defines WHO can DO WHAT on WHICH resources.
      Policies consumed by Approval Engine for workflow execution.
    responsibilities:
      - Store permission policies owned by service profiles
      - Store approval policies with approver rules owned by profiles
      - Use users and user groups from bc_users as policy subjects
      - Validate user/user group permissions
      - Determine approval requirements for actions
      - Provide policy evaluation API for approval workflows

  bc_approval_engine:
    id: bc_approval_engine
    name: Approval Engine
    domain_ref: dom_approval_workflows
    description: >
      Generic approval workflow execution engine. Executes workflows based on policies from
      Permission Management. Parallel approval only (MVP). Single or multiple approvers.
      Amount-based thresholds. States: pending, approved, rejected, expired.
      Reusable across all services.
    responsibilities:
      - Create approval workflow instances
      - Enforce approval rules (parallel approval)
      - Track approval progress
      - Update workflow state
      - Notify participants

  bc_account_data_sync:
    id: bc_account_data_sync
    name: Account Data Sync
    description: >
      Data engineering ETL infrastructure. Daily batch from SRF for client-owned accounts.
      Creates GOLD COPY of account data consumed by serving layer. Detects new/closed accounts.
      Data quality checks. Infrastructure supporting External Data domain.
    responsibilities:
      - Consume SRF daily batch feed
      - Create gold copy of account data
      - Detect account status changes (new, closed)
      - Data quality and transformation
      - Trigger auto-enrollment notifications

  bc_external_data_serving:
    id: bc_external_data_serving
    name: External Data Serving
    domain_ref: dom_external_data
    description: >
      SERVING LAYER providing READ-ONLY access to gold copy external data from SRF and Express.
      Service Profile domain consumes this for profile creation, account enrollment, and user
      synchronization. Three application services provide specialized access: client demographics,
      account data, and user data.
    responsibilities:
      - Provide read-only API to external data gold copies
      - Abstract SRF and Express systems from domain model
      - Support profile creation and validation workflows
      - Support account enrollment workflows
      - Support user synchronization for permission/approval enforcement
    application_services:
      - svc_app_client_data
      - svc_app_account_data
      - svc_app_user_data

  svc_app_client_data:
    id: svc_app_client_data
    name: Client Data Service
    bounded_context_ref: bc_external_data_serving
    description: >
      Application service providing read-only access to client demographics gold copy from SRF.
      Service Profile domain consumes this for profile creation and client validation.
    responsibilities:
      - Provide read-only API to client gold copy (SRF demographics)
      - Query client demographics by client ID (SRF/GID)
      - Validate client existence and status
      - Support online and servicing profile creation workflows

  svc_app_account_data:
    id: svc_app_account_data
    name: Account Data Service
    bounded_context_ref: bc_external_data_serving
    description: >
      Application service providing read-only access to account data gold copy from SRF daily batch.
      Service Profile domain consumes this for account enrollment and validation.
    responsibilities:
      - Provide read-only API to account gold copy (SRF batch)
      - Query account data by client ID
      - Validate account existence and status
      - Support account enrollment workflows for all profile types

  svc_app_user_data:
    id: svc_app_user_data
    name: User Data Service
    bounded_context_ref: bc_external_data_serving
    description: >
      Application service providing read-only access to user data gold copy from Express events.
      User Management domain (bc_users) consumes this for direct client user synchronization and
      Policy domain (bc_policy) consumes for permission/approval enforcement.
    responsibilities:
      - Provide read-only API to user gold copy (Express events)
      - Query user data by Express site-id
      - Validate user existence and status
      - Support user synchronization for bc_users
      - Support policy evaluation for bc_policy (permission/approval enforcement)

# ==============================================================================
# CONTEXT MAPPINGS
# ==============================================================================

context_mappings:
  cm_service_profile_to_external_data:
    id: cm_service_profile_to_external_data
    upstream_context: bc_external_data_serving
    downstream_context: bc_service_profile_management
    relationship_type: customer_supplier
    description: >
      Service Profile Management (downstream) consumes external data from External Data Serving
      (upstream) for profile creation, account enrollment, and validation. Read-only access to
      gold copies via three application services: svc_app_client_data (SRF demographics),
      svc_app_account_data (SRF batch), svc_app_user_data (Express events).

  cm_approval_engine_to_policy:
    id: cm_approval_engine_to_policy
    upstream_context: bc_policy
    downstream_context: bc_approval_engine
    relationship_type: customer_supplier
    description: >
      Approval Engine (downstream) consumes permission and approval policies from Policy
      (upstream). Evaluates policies owned by service profiles to determine approval requirements
      and enforce rules during workflow execution. Policies use users/user groups from bc_users
      as subjects.

  cm_receivable_approval_to_approval_engine:
    id: cm_receivable_approval_to_approval_engine
    upstream_context: bc_service_profile_management
    downstream_context: bc_approval_engine
    relationship_type: customer_supplier
    description: >
      Service Profile Management (via Receivable-Approval Enrollment application service)
      triggers invoice approvals via generic Approval Engine. Approval Engine provides
      reusable workflow execution.

  cm_service_profile_to_indirect_clients:
    id: cm_service_profile_to_indirect_clients
    upstream_context: bc_service_profile_management
    downstream_context: bc_indirect_client_management
    relationship_type: customer_supplier
    description: >
      Direct client service profile onboards indirect clients. One-to-many (1 profile →
      700 indirect clients, MVP).

  cm_identity_integration_to_express:
    id: cm_identity_integration_to_express
    upstream_context: express_platform
    downstream_context: bc_identity_integration
    relationship_type: anti_corruption_layer
    description: >
      Express publishes user events. Identity Integration consumes via ACL to protect
      domain from Express complexity (big ball of mud). Unidirectional: Express → Platform.

  cm_account_sync_to_srf:
    id: cm_account_sync_to_srf
    upstream_context: srf_system
    downstream_context: bc_account_data_sync
    relationship_type: anti_corruption_layer
    description: >
      SRF provides daily batch. Account Data Sync consumes via ACL to protect domain from
      SRF complexity. Creates gold copy.

metadata:
  phase: phase_2_strategic
  last_updated: "2025-10-15"
  key_changes:
    - Merged Client Management + Service Management into Service Profiles domain
    - Service profiles for clients, not client management itself
    - Indirect clients part of Service Profiles (exist only for service profiles)
    - Created Data Engineering domain with gold copy and serving layer
    - Receivable-approval is separate business service (not part of Receivables)
    - Serving layer provides read-only account data to Service Profile domain
